/*! Copyright 2026 Adobe
All Rights Reserved. */
import{jsx as a}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as v,useEffect as L}from"@dropins/tools/preact-compat.js";import{u as U,s as w,p as I,D as M,f as R}from"../chunks/localizedError.js";import{a as u}from"../chunks/location.js";import{useState as $}from"@dropins/tools/preact-hooks.js";import{useText as k}from"@dropins/tools/i18n.js";import"@dropins/tools/signals.js";import"../chunks/en_US.js";import"@dropins/tools/event-bus.js";import"@dropins/tools/lib.js";const d="payment-services_google-pay-container";function x(o){const e=I.value;switch(o){case u.CHECKOUT:return e==null?void 0:e.checkout;case u.PRODUCT_DETAIL:return e==null?void 0:e.productDetail;default:throw new Error(`Unsupported location: ${o}`)}}const X=({location:o,getCartId:e,createCart:n,onButtonClick:p,onSuccess:y,onError:g,getBillingAddress:C,hidden:_,disabled:m})=>{if(!e&&!n||e&&n)throw new Error("Either getCartId or createCart must be provided and not both.");const s=x(o),[f,b]=$(null),r=v(null),h=U(),E=v(!!m),{methodNotAvailableMessage:D,methodNotLoadedMessage:G,methodLoadingMessage:T}=k({methodNotAvailableMessage:"PaymentServices.messages.methodNotAvailable",methodNotLoadedMessage:"PaymentServices.messages.methodNotLoaded",methodLoadingMessage:"PaymentServices.messages.methodLoading"});L(()=>{let i=null;if(!(s!=null&&s.Payment.GooglePay.isAvailable())||!r.current)return;const P=`google-pay-${Math.random().toString(36).slice(2,11)}`;r.current.id=P;const N=async()=>{if(e)return e();const t=n.getCartItems();if(!t)throw new Error("No items found to be added to the cart.");return i=s._Utils.addProductsToNewCart(F(t)),(await i).cartId},O=()=>{i!==null&&i.then(async({cartId:t})=>{await s._Utils.setCartAsInactive(t)}).catch(console.error)},S={getCartId:N,getBillingAddress:C,useGooglePayShippingAddress:o===u.PRODUCT_DETAIL,useGooglePayBillingAddress:o===u.PRODUCT_DETAIL,onSuccess:y,onError:t=>{g===void 0?console.error(t):(console.log(t),g(R("GooglePay",t)))},buttonLanguage:{locale:A(h)},container:`#${P}`,onButtonClick:p,onCancel:O,disabled:E.current,skipReviewStep:!0};let c=null;return s.Payment.GooglePay.render(S).then(t=>{c=t,b(c)}).catch(t=>{console.error("Google Pay render failed:",t)}),()=>{c&&c.teardown()}},[s,o,e,n,y,g,p,h]),L(()=>{f&&f.setDisabled(!!m)},[f,m]);const l={display:_?"none":"block"};return s&&!s.Payment.GooglePay.isAvailable()?a("div",{ref:r,class:d,style:l,children:a("div",{class:"google-pay-error",children:D})}):w.value==="error"?a("div",{ref:r,class:d,style:l,children:a("div",{class:"google-pay-error",children:G})}):w.value==="initializing"?a("div",{ref:r,class:d,style:l,children:a("div",{class:"google-pay-loading",children:T})}):a("div",{ref:r,class:d,style:l})};function F(o){return o.map(e=>({sku:e.sku,quantity:e.quantity,parent_sku:e.parentSku,selected_options:e.selectedOptions,entered_options:e.enteredOptions}))}function A(o){const e=o.split("_");if(e.length<2){const n=A(M);return console.warn(`Cannot map elsie locale "${o}" to google pay button locale. Falling back to "${n}".`),n}return`${e[0]}-${e[1]}`}export{X as GooglePay,X as default};
//# sourceMappingURL=GooglePay.js.map
